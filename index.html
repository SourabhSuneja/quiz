<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz | Powered by Sourabh Suneja</title>
<style>
  body {
    background-color: black;
    color: white;
    font-family: Arial, sans-serif;
    font-size: 18px;
  }
  .container {
    max-width: 600px;
    margin: 50px auto;
    padding: 20px;
    border: 2px solid white;
    border-radius: 10px;
    text-align: center;
  }
  h1 {
    text-align: center;
    font-size: 24px;
  }
  .question {
    margin-bottom: 20px;
    font-size: 20px;
  }
  .buttons {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
  }
  button {
    margin: 10px;
    padding: 10px 20px;
    background-color: #1E90FF; /* Dark blue shade */
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
    font-size: 18px;
  }
  button:hover {
    background-color: #4682B4; /* Lighter shade on hover */
  }
  footer {
    margin-top: 20px;
    font-size: 14px;
  }
</style>
</head>
<body>

<div class="container">
  <h1>Quiz</h1>
  <div class="question">
    <p id="questionText"></p>
    <p id="studentName"></p>
  </div>
  <div class="buttons">
    <button id="correctBtn">Answered correctly</button>
    <button id="incorrectBtn">Couldn't answer correctly</button>
    <button id="pickAnotherBtn">Pick another student</button>
  </div>
  <footer id="footerText">Powered by Sourabh Suneja</footer>
</div>

<script>
  // Function to initialize quiz
  async function initializeQuiz() {
  try {
    let studentsFileName = prompt("Enter the file name for students data (e.g., students.txt):");
    let questionsFileName = prompt("Enter the file name for questions data (e.g., questions.txt):");
    
    // Add .txt extension if not already provided by the user
    if (!studentsFileName.endsWith('.txt')) {
      studentsFileName += '.txt';
    }
    if (!questionsFileName.endsWith('.txt')) {
      questionsFileName += '.txt';
    }

    if (!studentsFileName || !questionsFileName) {
      throw new Error("Invalid file names");
    }
    const studentsData = await fetchData(studentsFileName);
    const questionsData = await fetchData(questionsFileName);
    startQuiz(studentsData, questionsData);
  } catch (error) {
    console.error(error.message);
  }
}

  // Function to fetch data from a file using AJAX and return a promise
  function fetchData(fileName) {
    return new Promise((resolve, reject) => {
      const xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            const data = xhr.responseText.split('\n').map(item => item.trim()).filter(item => item !== '');
            resolve(data);
          } else {
            reject(new Error("Failed to load data"));
          }
        }
      };
      xhr.open("GET", fileName, true);
      xhr.send();
    });
  }

  // Function to start the quiz after questions and students are loaded
function startQuiz(students, questions) {
  window.students = students;
  window.questions = questions;
  initializeScores();
  displayQuestion();
  document.getElementById("correctBtn").addEventListener("click", answeredCorrectly);
  document.getElementById("incorrectBtn").addEventListener("click", answeredIncorrectly);
  document.getElementById("pickAnotherBtn").addEventListener("click", pickAnotherStudent);
}

// Function to initialize scores and chances for each student
function initializeScores() {
  for (const student of window.students) {
    scores[student] = { correctAnswers: 0, chances: 0 };
  }
}

  // Function to display question and student name
  function displayQuestion() {
    if (!window.students || !window.questions) {
      console.log("Students or questions data not loaded.");
      return;
    }
    const questionText = document.getElementById("questionText");
    const studentName = document.getElementById("studentName");
    questionText.textContent = window.questions[currentQuestionIndex];
    let randomStudent = pickRandomStudent();
    studentName.textContent = "Question for " + randomStudent;
  }

  // Function to pick a random student, ensuring they are not absent
  function pickRandomStudent() {
    let currentIndex = window.students.length;
    let temporaryValue, randomIndex;

    // While there remain elements to shuffle...
    while (currentIndex !== 0) {
      // Pick a remaining element...
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex -= 1;

      // And swap it with the current element.
      temporaryValue = window.students[currentIndex];
      window.students[currentIndex] = window.students[randomIndex];
      window.students[randomIndex] = temporaryValue;
    }

    let randomStudentIndex = Math.floor(Math.random() * window.students.length);
    return window.students[randomStudentIndex];
  }

  // Function to handle correct answer
function answeredCorrectly() {
  const currentStudent = document.getElementById("studentName").textContent.split(" ")[2];
  scores[currentStudent].correctAnswers++;
  scores[currentStudent].chances++;
  nextQuestion();
}

  // Function to handle incorrect answer
function answeredIncorrectly() {
  const currentStudent = document.getElementById("studentName").textContent.split(" ")[2];
  scores[currentStudent].chances++;
  nextQuestion();
}

  // Function to move to the next question
  function nextQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex < window.questions.length) {
      displayQuestion();
    } else {
      displayScores();
    }
  }

// Function to pick another student
function pickAnotherStudent() {
  const currentStudent = document.getElementById("studentName").textContent.split(" ")[2];
  scores[currentStudent].chances++;
  displayQuestion();
}


  // Function to display scores
function displayScores() {
  const container = document.querySelector(".container");
  container.innerHTML = "<h1>Scores</h1>";
  for (const student in scores) {
    const { correctAnswers, chances } = scores[student];
    container.innerHTML += "<p>" + student + ": " + correctAnswers + "/" + chances + "</p>";
  }
}

  // Array to store scores
  let scores = {};

  // Array to store absent students
  let absentStudents = [];

  // Index to keep track of current question
  let currentQuestionIndex = 0;

  // Initialize quiz when the page loads
  window.onload = initializeQuiz;
</script>

</body>
</html>